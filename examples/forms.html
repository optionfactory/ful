<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" integrity="sha256-oxqX0LQclbvrsJt8IymkxnISn4Np2Wy2rY9jjoQlDEg=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha256-y3ibfOyBqlgBd+GzwFYQEVOZdNJD06HeDXihongBXKs=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/@optionfactory/ftl@2.0.6/dist/ftl.iife.min.js" crossorigin="anonymous"></script>

    <link href="../dist/ful.css" rel="stylesheet">
    <script src="../dist/ful.iife.min.js"></script>
    <style>
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem 1rem;

            h2, 
            .full-row {
                grid-column: 1 / -1;
            }

            fieldset {
                display: contents;
            }

        }

        h2 {
            font-size: 22px;
            background-color: #ccd6ffaa;
            padding: 1rem;
        }
    </style>
    <script>
        const sleep = ful.timing.sleep;
        const Failure = ful.Failure;


        ftl.registry
            .plugin(new ful.Plugin())
            .configure();

        ful.AsyncEvents.mixInto(HTMLElement, HTMLDocument);
    </script>
</head>

<body>
    <div class="container">
        <ful-form scroll-on-error>
            <h1>Form associated elements</h1>
            <div class="form-grid">
                <fieldset>
                    <h2>Inputs</h2>
                    <ful-input name="text.plain" class="mb-3" value="123">
                        text plain <sup>*</sup>
                    </ful-input>
                    <ful-input name="text.icons.before" class="mb-3">
                        Text with icon before
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="text.icons.after" class="mb-3">
                        Text with icon after
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="text.icons.both" class="mb-3">
                        Text with icons
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="datetime" type="datetime-local" class="mb-3">
                        datetime-local
                    </ful-input>
                    <ful-input name="date" type="date" class="mb-3">
                        date
                    </ful-input>
                    <ful-input name="time" type="time" class="mb-3">
                        time
                    </ful-input>
                    <ful-input name="texarea" type="textarea" class="mb-3">
                        time
                    </ful-input>

                </fieldset>
                <fieldset disabled>
                    <h2>A disabled fieldset</h2>
                    <ful-input name="text.disabled.plain" class="mb-3" value="123">
                        text plain <sup>*</sup>
                    </ful-input>
                    <ful-input name="text.disabled.icons.before" class="mb-3">
                        Text with icon before
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="text.disabled.icons.after" class="mb-3">
                        Text with icon after
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="text.disabled.icons.both" class="mb-3">
                        Text with icons
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="disabled.datetime" type="datetime-local" class="mb-3">
                        datetime-local
                    </ful-input>
                    <ful-input name="disabled.date" type="date" class="mb-3">
                        date
                    </ful-input>
                    <ful-input name="disabled.time" type="time" class="mb-3">
                        time
                    </ful-input>
                    <ful-input name="disabled.texarea" type="textarea" class="mb-3">
                        time
                    </ful-input>                    
                </fieldset>
                <fieldset>
                    <h2>Readonly fields</h2>
                    <ful-input name="text.readonly.plain" class="mb-3" value="123" readonly>
                        text plain <sup>*</sup>
                    </ful-input>
                    <ful-input name="text.readonly.icons.before" class="mb-3" readonly>
                        Text with icon before
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="text.readonly.icons.after" class="mb-3" readonly>
                        Text with icon after
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="text.readonly.icons.both" class="mb-3" readonly>
                        Text with icons
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                    </ful-input>
                    <ful-input name="readonly.datetime" type="datetime-local" class="mb-3" readonly>
                        datetime-local
                    </ful-input>
                    <ful-input name="readonly.date" type="date" class="mb-3" readonly>
                        date
                    </ful-input>
                    <ful-input name="readonly.time" type="time" class="mb-3" readonly>
                        time
                    </ful-input>
                    <ful-input name="readonly.texarea" type="textarea" class="mb-3" readonly>
                        time
                    </ful-input>                    
                </fieldset>

                <fieldset>
                    <h2>Select</h2>
                    <ful-select name="select.single.noicons" class="mb-3">
                        select local single no icons
                        <select slot="options">
                            <option value="16">aaa</option>
                            <option value="17">zzz</option>
                        </select>
                    </ful-select>

                    <ful-select name="select.single.iconbefore" class="mb-3">
                        select local single icon before
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                        <select slot="options">
                            <option value="16">aaa</option>
                            <option value="17">zzz</option>
                        </select>
                    </ful-select>

                    <ful-select name="select.single.iconafter" class="mb-3">
                        select local single icon after
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                        <select slot="options">
                            <option value="16">aaa</option>
                            <option value="17">zzz</option>
                        </select>
                    </ful-select>

                    <ful-select name="select.single.icons" class="mb-3">
                        select local single 2 icons
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                        <select slot="options">
                            <option value="16">aaa</option>
                            <option value="17">zzz</option>
                        </select>
                    </ful-select>
                    <ful-select type="remote" name="select.multiple" input-class="form-select" multiple class="mb-3">
                        select multiple
                        <i slot="ibefore" class="bi bi-envelope-at"></i>
                        <i slot="iafter" class="bi bi-envelope-at"></i>
                        <select slot="options">
                            <option value="16">aaa</option>
                            <option value="17">zzz</option>
                        </select>
                    </ful-select>
                </fieldset>
                <fieldset>
                    <h2>Radio groups</h2>
                    <ful-radio-group name="radio.vertical" class="mb-3">
                        A vertical radio group
                        <ful-radio value="one">One</ful-radio>
                        <ful-radio value="two">Two</ful-radio>
                    </ful-radio-group>

                    <ful-radio-group name="radio.horizontal" class="mb-3 horizontal">
                        An horizontal radio group
                        <ful-radio value="one">One</ful-radio>
                        <ful-radio value="two">Two</ful-radio>
                    </ful-radio-group>

                    <ful-radio-group name="radio.vertical" class="mb-3">
                        A vertical radio group with multiline text
                        <ful-radio value="one">
                            <div class="text-black">One title</div>
                            <div class="text-secondary">One subtitle</div>
                        </ful-radio>
                        <ful-radio value="two">Two</ful-radio>
                    </ful-radio-group>
                    
                    <ful-radio-group name="radio.horizontal" class="mb-3 horizontal">
                        An horizontal radio group with multiline text
                        <ful-radio value="one">
                            <div class="text-black">One title</div>
                            <div class="text-secondary">One subtitle</div>
                        </ful-radio>
                        <ful-radio value="two">Two</ful-radio>
                    </ful-radio-group>

                </fieldset>

                <fieldset>
                    <h2>Checkboxes</h2>
                    <ful-checkbox name="checkbox.normal" class="mb-3">
                        A checkbox
                    </ful-checkbox>

                    <ful-checkbox name="checkbox.longtext.normal" class="mb-3">
                        A checkbox with long text: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                        incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris 
                        nisi ut aliquip ex ea commodo consequat. 
                    </ful-checkbox>


                    <ful-checkbox type="switch" name="checkbox.switch" class="mb-3">
                        A switch
                    </ful-checkbox>
                    <ful-checkbox type="switch" name="checkbox.longtext.switch" class="mb-3">
                        A switch with long text: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                        incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris 
                        nisi ut aliquip ex ea commodo consequat. 
                    </ful-checkbox>
                </fieldset>

                <h2>Filters</h2>
                <ful-filter-text name="filter.text" class="mb-3">

                </ful-filter-text>
                <ful-filter-local-date name="filter.localdate" class="mb-3">

                </ful-filter-local-date>
                <ful-filter-instant name="filter.instant" class="mb-3">

                </ful-filter-instant>

                <ful-errors class="full-row" hidden></ful-errors>

                <div class="full-row">
                    <button type="submit" class="btn btn-primary">
                        <ful-spinner hidden></ful-spinner>
                        submit
                    </button>

                </div>
            </div>
        </ful-form>
    </div>
    <script>


/*
        ftl.registry.defineComponent("mapper:mock-failure", async (values, form) => {
            await sleep(2_000);
            const fieldErrors = Array.from(form.form.elements)
                .map(el => el.getAttribute("name"))
                .filter(name => name)
                .map(name => ({ type: 'FIELD_ERROR', context: name, reason: `${name} is invalid` }));
            throw new Failure(0, [...fieldErrors, {
                type: 'GLOBAL_ERROR',
                reason: 'Global Error message'
            }])
        });
*/
        document.asyncOn('submit:requested', async (evt) => {
            await sleep(2_000);
            const fieldErrors = Array.from(evt.target.form.elements)
                .map(el => el.getAttribute("name"))
                .filter(name => name)
                .map(name => ({ type: 'FIELD_ERROR', context: name, reason: `${name} is invalid` }));
            throw new Failure(0, [...fieldErrors, {
                type: 'GLOBAL_ERROR',
                reason: 'Global Error message'
            }])
        });

        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll('ful-select').forEach(el => {
                el.addEventListener('change', evt => {
                    console.log("ful-select changed", evt);
                });
            })
            document.querySelector('[name="radio.horizontal"]').addEventListener('change', evt => {
                console.log("event:val", evt, evt.currentTarget, evt.target, "cancelable", evt.cancelable);
            });
        });

    </script>
</body>

</html>