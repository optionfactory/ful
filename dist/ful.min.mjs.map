{"version":3,"file":"ful.min.mjs","sources":["../src/bindings.mjs","../src/encodings.mjs","../src/forms.mjs","../src/http-client.mjs","../src/storage.mjs","../src/oauth-authorization-code.mjs","../src/timing.mjs","../src/wizard.mjs","../src/app.mjs"],"sourcesContent":["/* global CSS */\n\nfunction extract(extractors, el) {\n    const maybeExtractor = extractors[el.dataset['bindExtractor']] || extractors[el.dataset['bindProvide']];\n    if (maybeExtractor) {\n        return maybeExtractor(el);\n    }\n    if (el.getAttribute('type') === 'radio') {\n        if (!el.checked) {\n            return undefined;\n        }\n        return el.dataset['bindType'] === 'boolean' ? el.value === 'true' : el.value;\n    }\n    if (el.getAttribute('type') === 'checkbox') {\n        return el.checked;\n    }\n    if (el.dataset['bindType'] === 'boolean') {\n        return !el.value ? null : el.value === 'true';\n    }\n    return el.value || null;\n}\n\nfunction mutate(mutators, el, raw, key, values) {\n    const maybeMutator = mutators[el.dataset['bindMutator']] || mutators[el.dataset['bindProvide']];\n    if (maybeMutator) {\n        maybeMutator(el, raw, key, values);\n        return;\n    }\n    if (el.getAttribute('type') === 'radio') {\n        el.checked = el.getAttribute('value') === raw;\n        return;\n    }\n    if (el.getAttribute('type') === 'checkbox') {\n        el.checked = raw;\n        return;\n    }\n    el.value = raw;\n}\n\n\nfunction providePath(result, path, value) {\n    const keys = path.split(\".\").map((k) => k.match(/^[0-9]+$/) ? +k : k);\n    let current = result;\n    let previous = null;\n    for (let i = 0; ; ++i) {\n        const ckey = keys[i];\n        const pkey = keys[i - 1];\n        if (Number.isInteger(ckey) && !Array.isArray(current)) {\n            if (previous !== null) {\n                previous[pkey] = current = [];\n            } else {\n                result = current = [];\n            }\n        }\n        if (i === keys.length - 1) {\n            //when value is undefined we only want to define the property if it's not defined \n            current[ckey] = value !== undefined ? value : (ckey in current ? current[ckey] : null);\n            return result;\n        }\n        if (current[ckey] === undefined) {\n            current[ckey] = {};\n        }\n        previous = current;\n        current = current[ckey];\n    }\n}\n\nclass Bindings {\n\n    constructor( {extractors, mutators, ignoredChildrenSelector, valueHoldersSelector}) {\n        this.extractors = extractors || {};\n        this.mutators = mutators || {};\n        this.valueHoldersSelector = valueHoldersSelector || 'input[name], select[name], textarea[name]';\n        this.ignoredChildrenSelector = ignoredChildrenSelector || '.d-none';\n    }\n    setValues(el, values) {\n        for (let k in values) {\n            if (!values.hasOwnProperty(k)) {\n                continue;\n            }\n            Array.from(el.querySelectorAll(`[name='${CSS.escape(k)}']`)).forEach((el) => {\n                mutate(this.mutators, el, values[k], k, values);\n            });\n        }\n    }\n    getValues(el) {\n        return Array.from(el.querySelectorAll(this.valueHoldersSelector))\n                .filter((el) => {\n                    if (el.dataset['bindInclude'] === 'never') {\n                        return false;\n                    }\n                    return el.dataset['bindInclude'] === 'always' || el.closest(this.ignoredChildrenSelector) === null;\n                })\n                .reduce((result, el) => {\n                    return providePath(result, el.getAttribute('name'), extract(this.extractors, el));\n                }, {});\n    }\n}\n\n\n\nexport { Bindings };","\n\nclass Base64 {\n    static encode(arrayBuffer, dialect) {\n        const d = dialect || Base64.URL_SAFE;\n        const len = arrayBuffer.byteLength;\n        const view = new Uint8Array(arrayBuffer);\n        let res = '';\n        for (let i = 0; i < len; i += 3) {\n            const v1 = d[view[i] >> 2];\n            const v2 = d[((view[i] & 3) << 4) | (view[i + 1] >> 4)];\n            const v3 = d[((view[i + 1] & 15) << 2) | (view[i + 2] >> 6)];\n            const v4 = d[view[i + 2] & 63];\n            res += v1 + v2 + v3 + v4;\n        }\n        if (len % 3 === 2) {\n            res = res.substring(0, res.length - 1);\n        } else if (len % 3 === 1) {\n            res = res.substring(0, res.length - 2);\n        }\n        return res;\n    }\n    static decode(str, dialect) {\n        const d = dialect || Base64.URL_SAFE;\n        let nbytes = Math.floor(str.length * 0.75);\n        for (let i = 0; i !== str.length; ++i) {\n            if (str[str.length - i - 1] !== '=') {\n                break;\n            }\n            --nbytes;\n        }\n        const view = new Uint8Array(nbytes);\n\n        let vi = 0;\n        let si = 0;\n        while (vi < str.length * 0.75) {\n            const v1 = d.indexOf(str.charAt(si++));\n            const v2 = d.indexOf(str.charAt(si++));\n            const v3 = d.indexOf(str.charAt(si++));\n            const v4 = d.indexOf(str.charAt(si++));\n            view[vi++] = (v1 << 2) | (v2 >> 4);\n            view[vi++] = ((v2 & 15) << 4) | (v3 >> 2);\n            view[vi++] = ((v3 & 3) << 6) | v4;\n        }\n\n        return view.buffer;\n    }\n}\n\nBase64.STANDARD = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\nBase64.URL_SAFE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';\n\n\nclass Hex {\n    static decode(hex) {\n        if (hex.length % 2 !== 0) {\n            throw new Error(\"invalid length\");\n        }\n        const lenInBytes = hex.length / 2;\n        return new Uint8Array(lenInBytes).map((e, i) => {\n            const offset = i * 2;\n            const octet = hex.substring(offset, offset + 2);\n            return parseInt(octet, 16);\n        });\n    }\n    static encode(bytes, upper) {\n        return Array.from(bytes)\n                .map(b => b.toString(16))\n                .map(b => upper ? b.toUpperCase() : b)\n                .map(o => o.padStart(2, 0))\n                .join('');\n    }\n}\n\nexport { Base64, Hex };","/* global Infinity, CSS */\n\n\nclass Form {\n    constructor(el, bindings, {globalErrorsEl, fieldContainerSelector, errorClass, hideClass}) {\n        this.el = el;\n        this.bindings = bindings;\n        this.globalErrorsEl = globalErrorsEl;\n        this.fieldContainerSelector = fieldContainerSelector !== undefined ? fieldContainerSelector : Form.DEFAULT_FIELD_CONTAINER_SELECTOR;\n        this.errorClass = errorClass || Form.DEFAULT_ERROR_CLASS;\n        this.hideClass = hideClass || Form.DEFAULT_HIDE_CLASS;\n    }\n    setValues(values) {\n        return this.bindings.setValues(this.el, values);\n    }\n    getValues() {\n        return this.bindings.getValues(this.el);\n    }\n    setErrors(errors, scrollFirstErrorIntoView, context) {\n\n        this.clearErrors();\n        errors\n                .map(this.mapError ? this.mapError : (e) => e)\n                .filter((e) => e.type === 'FIELD_ERROR' || e.type === 'INVALID_FORMAT')\n                .forEach((e) => {\n                    const name = e.context.replace(\"[\", \".\").replace(\"].\", \".\");\n                    Array.from(this.el.querySelectorAll(`[name='${CSS.escape(name)}']`))\n                            .map(el => this.fieldContainerSelector ? el.closest(this.fieldContainerSelector) : el)\n                            .filter(el => el !== null)\n                            .forEach(label => {\n                                label.classList.add(this.errorClass);\n                                label.dataset['error'] = e.reason;\n                            });\n                });\n        if (this.globalErrorsEl) {\n            const globalErrors = errors.filter((e) => e.type !== 'FIELD_ERROR' && e.type !== 'INVALID_FORMAT');\n            this.globalErrorsEl.innerHTML = globalErrors.map(e => e.reason).join(\"\\n\");\n            if (globalErrors.length !== 0) {\n                this.globalErrorsEl.classList.remove(this.hideClass);\n            }\n        }\n        if (!scrollFirstErrorIntoView) {\n            return;\n        }\n        const yOffsets = Array.from(this.el.querySelectorAll('.${CSS.escape(this.errorClass)}'))\n                .map((label) => label.getBoundingClientRect().y + window.scrollY);\n        const firstErrorScrollY = Math.min(...yOffsets);\n        if (firstErrorScrollY !== Infinity) {\n            window.scroll(window.scrollX, firstErrorScrollY > 100 ? firstErrorScrollY - 100 : 0);\n        }\n    }\n    clearErrors() {\n        this.el.querySelectorAll(`.${CSS.escape(this.errorClass)}`).forEach(l => l.classList.remove(this.errorClass));\n        if (this.globalErrorsEl) {\n            this.globalErrorsEl.innerHTML = '';\n            this.globalErrorsEl.classList.add(this.hideClass);\n        }\n    }\n}\n\nForm.DEFAULT_FIELD_CONTAINER_SELECTOR = 'label';\nForm.DEFAULT_ERROR_CLASS = 'has-error';\nForm.DEFAULT_HIDE_CLASS = 'd-none';\n\n\n/*\n export function forms() {\n }\n \n forms.dropContext = function (context) {\n return function (e) {\n if (e.context && e.context.indexOf(context) === 0) {\n e.context = e.context.substring(context.length);\n }\n return e;\n };\n };\n \n \n Dom.ready(() => {\n document.querySelectorAll('label:not([data-error])').forEach(el => {\n el.dataset['error'] = \"Il valore inserito non Ã¨ valido\";\n });\n });\n \n Dom.ready(() => {\n Dom.on(document.body, 'change', '[data-pattern]', {}, evt => {\n const el = evt.srcElement;\n const pattern = el.dataset['pattern'];\n const matches = el.value.match(pattern);\n const label = el.closest('label');\n if(label === null){\n return;\n }\n label.classList[matches ? 'remove' : 'add']('has-error');        \n });\n });\n */\nexport { Form };","class ContextInterceptor {\n    constructor() {\n        const context = document.querySelector(\"meta[name='context']\").getAttribute(\"content\");\n        this.context = context.endsWith(\"/\") ? context.substring(0, context.length - 1) : context;\n    }\n    before(request) {\n        const separator = request.resource.startsWith(\"/\") ? \"\" : \"/\";\n        request.resource = this.context + separator + request.resource;\n    }\n}\n\nclass CsrfTokenInterceptor {\n    constructor() {\n        this.k = document.querySelector(\"meta[name='_csrf_header']\").getAttribute(\"content\");\n        this.v = document.querySelector(\"meta[name='_csrf']\").getAttribute(\"content\");\n    }\n    before(request) {\n        const headers = new Headers(request.options.headers);\n        headers.set(this.k, this.v);\n        request.options.headers = headers;\n    }\n}\n\nclass RedirectOnUnauthorizedInterceptor {\n    constructor(redirectUri) {\n        this.redirectUri = redirectUri;\n    }\n    after(request, response) {\n        if (response.status !== 401) {\n            return;\n        }\n        window.location.href = redirectUri;\n    }\n}\n\nclass Failure extends Error {\n    static parseProblems(status, text) {\n        const def = [{\n                type: \"GENERIC_PROBLEM\",\n                context: null,\n                reason: `${status}: ${text}`,\n                details: null\n            }];\n        try {\n            return text ? JSON.parse(text) : def;\n        } catch (e) {\n            return def;\n        }\n    }\n    static fromResponse(status, text) {\n        return new Failure(status, Failure.parseProblems(status, text));\n    }\n    constructor(status, problems) {\n        super(JSON.stringify(problems));\n        this.name = `Failure:${status}`;\n        this.status = status;\n        this.problems = problems;\n    }\n}\n\nclass HttpClientBuilder {\n    constructor() {\n        this.interceptors = [];\n    }\n    withContext() {\n        this.interceptors.push(new ContextInterceptor());\n        return this;\n    }\n    withCsrfToken() {\n        this.interceptors.push(new CsrfTokenInterceptor());\n        return this;\n    }\n    withRedirectOnUnauthorized(redirectUri) {\n        this.interceptors.push(new RedirectOnUnauthorizedInterceptor(redirectUri));\n        return this;\n    }\n    withInterceptors(...interceptors) {\n        this.interceptors.push(...interceptors);\n        return this;\n    }\n    build() {\n        const interceptors = this.interceptors;\n        return new HttpClient({interceptors});\n    }\n}\n\nclass HttpClient {\n    static builder() {\n        return new HttpClientBuilder();\n    }\n    constructor( {interceptors}){\n        this.interceptors = interceptors || [];\n    }\n    async fetch(resource, options) {\n        const is = this.interceptors.concat(options.interceptors || []);\n        const request = {resource, options};\n        await is.forEach(async (i) => {\n            if (!i.before) {\n                return;\n            }\n            await i.before(request);\n        });\n        const response = await fetch(request.resource, request.options);\n        await is.forEach(async (i) => {\n            if (!i.after) {\n                return;\n            }\n            await i.after(request, response);\n        });\n\n        return response;\n    }\n    async json(resource, options) {\n        try {\n            const response = await this.fetch(resource, options);\n            if (!response.ok) {\n                const message = await response.text();\n                throw Failure.fromResponse(response.status, message);\n            }\n            const text = await response.text();\n            return text ? JSON.parse(text) : undefined;\n        } catch (e) {\n            if (e instanceof Failure) {\n                throw e;\n            }\n            throw new Failure(0, [{\n                    type: \"CONNECTION_PROBLEM\",\n                    context: null,\n                    reason: e.message,\n                    details: null\n                }]);\n        }\n    }\n    async form(resource, options, uiOptions) {\n        const ui = uiOptions || {};\n        ui.buttons?.forEach(el => {\n            el.setAttribute(\"disabled\", \"disabled\");\n            if (ui.loader) {\n                el.dataset['oldContent'] = el.innerHTML;\n                el.innerHTML = ui.loader;\n            }\n        });\n        try {\n            const r = await this.json(resource, options);\n            ui.form?.clearErrors();\n            return r;\n        } catch (e) {\n            ui.form?.setErrors(e.problems);\n            throw e;\n        } finally {\n            ui.buttons?.forEach(el => {\n                el.removeAttribute(\"disabled\");\n                el.innerHTML = el.dataset['oldContent'];\n                delete el.dataset['oldContent'];\n            });\n        }\n    }\n}\n\n\n\nexport { HttpClient, Failure };\n","\nclass Storage {\n    constructor(prefix, storage) {\n        this.prefix = prefix;\n        this.storage = storage;\n    }\n    save(k, v) {\n        this.storage.setItem(`${this.prefix}-${k}`, JSON.stringify(v));\n    }\n    load(k) {\n        const got = this.storage.getItem(`${this.prefix}-${k}`);\n        return got === undefined ? undefined : JSON.parse(got);\n    }\n    remove(k) {\n        this.storage.removeItem(`${this.prefix}-${k}`);\n    }\n    pop(k) {\n        const decoded = this.access(k);\n        this.remove(k);\n        return decoded;\n    }\n}\n\nclass LocalStorage extends Storage {\n    constructor(prefix) {\n        super(prefix, localStorage);\n    }\n}\n\nclass SessionStorage extends Storage {\n    constructor(prefix) {\n        super(prefix, sessionStorage);\n    }\n}\n\nclass VersionedStorage {\n    constructor(storage, key, dataSupplier){\n        this.storage = storage;\n        this.key = key;\n        this.dataSupplier = dataSupplier;\n        this.cache = null;\n        \n    }\n    async load(revision){\n        const saved = this.storage.load(this.key);\n        if (!!saved && saved.revision === revision) {\n            this.cache = saved.value;\n            return;\n        }\n        const freshData = await this.dataSupplier(revision, this.key);\n        this.storage.save(this.key, {\n            revision: revision,\n            value: freshData\n        });\n        this.cache = freshData;\n    }\n    data(){\n        return this.cache;\n    }\n}\n\n\n\nexport {LocalStorage, SessionStorage, VersionedStorage};","import { Base64 } from \"./encodings.mjs\";\nimport { SessionStorage } from \"./storage.mjs\";\n\n\nclass AuthorizationCodeFlow {\n    static forKeycloak(clientId, realmBaseUrl, redirectUri){\n        const authUri = new URL(\"protocol/openid-connect/auth\", realmBaseUrl);\n        const tokenUri = new URL(\"protocol/openid-connect/token\", realmBaseUrl);\n        const logoutUri = new URL(\"protocol/openid-connect/lgout\", realmBaseUrl);\n        const scope = \"openid profile\";\n        return new AuthorizationCodeFlow(clientId, scope, authUri, tokenUri, logoutUri, redirectUri);        \n    }\n    constructor(clientId, scope, authUri, tokenUri, logoutUri, redirectUri) {\n        this.clientId = clientId;\n        this.scope = scope;\n        this.authUri = authUri;\n        this.tokenUri = tokenUri;\n        this.logoutUri = logoutUri;\n        this.redirectUri = redirectUri;\n        this.storage = new SessionStorage(clientId);\n    }\n    _auth() {\n        const pkceVerifier = Base64.encode(crypto.getRandomValues(new Uint8Array(32)).buffer);\n        const pkceChallenge = Base64.encode(crypto.subtle.digest(\"SHA-256\", new TextEncoder().encode(pkceVerifier)));\n        const state = this.clientId + Base64.encode(crypto.getRandomValues(new Uint8Array(16)).buffer);\n        this.storage.save(AuthorizationCodeFlow.PKCE_AND_STATE_KEY, {\n            state: state,\n            verifier: pkceVerifier\n        });\n        const url = new URL(this.authUri);\n        url.searchParams.set(\"client_id\", this.clientId);\n        url.searchParams.set(\"redirect_uri\", this.redirectUri);\n        url.searchParams.set(\"response_type\", 'code');\n        url.searchParams.set(\"scope\", this.scope);\n        url.searchParams.set(\"state\", state);\n        url.searchParams.set(\"code_challenge\", pkceChallenge);\n        url.searchParams.set(\"code_challenge_method\", 'S256');\n        window.location = url;\n    }\n    async _tokenExchange(code, state) {\n        window.history.replaceState('', \"\", this.redirectUri);\n        const stateAndVerifier = this.storage.pop(AuthorizationCodeFlow.PKCE_AND_STATE_KEY);\n        if (stateAndVerifier.state !== state) {\n            throw new Error(\"State mismatch\");\n        }\n        const response = await fetch(this.tokenUri, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": 'application/x-www-form-urlencoded'\n            },\n            body: new URLSearchParams([\n                [\"client_id\", this.clientId],\n                [\"code\", code],\n                [\"grant_type\", \"authorization_code\"],\n                [\"code_verifier\", stateAndVerifier.verifier],\n                [\"state\", stateAndVerifier.state],\n                [\"redirect_uri\", this.redirectUri]\n            ])\n        });\n        if (!response.ok) {\n            const text = await response.text();\n            throw new Error(\"Error:\" + response.status + \": \" + text);\n        }\n        const token = await response.json();\n        return new AuthorizationCodeFlowSession(this.clientId, token, this.tokenUri, this.logoutUri, this.redirectUri);\n    }\n\n    async ensureLoggedIn() {\n        const url = new URL(window.location.href);\n        const code = url.searchParams.get(\"code\");\n        if (code) {\n            //if callback from keycloak\n            const state = url.searchParams.get(\"state\");\n            return await this._tokenExchange(code, state);\n        }\n        //if not authorized\n        this._auth();\n        return null;\n    }\n}\nAuthorizationCodeFlow.PKCE_AND_STATE_KEY = \"state-and-verifier\";\n\nclass AuthorizationCodeFlowSession {\n    static parseToken(token) {\n        const [rawHeader, rawPayload, signature] = token.split(\".\");\n        return {\n            header: JSON.parse(atob(rawHeader)),\n            payload: JSON.parse(atob(rawPayload)),\n            signature: signature\n        };\n    }    \n    constructor(clientId, token, tokenUri, logoutUri, redirectUri) {\n        this.clientId = clientId;\n        this.token = token;\n        this.tokenUri = tokenUri;\n        this.logoutUri = logoutUri;\n        this.redirectUri = redirectUri;\n        this.accessToken = AuthorizationCodeFlowSession.parseToken(token.access_token);\n        this.refreshToken = AuthorizationCodeFlowSession.parseToken(token.refresh_token);\n        this.refreshCallback = null;\n    }\n    onRefresh(callback) {\n        this.refreshCallback = callback;\n    }\n    async refresh() {\n        const response = await fetch(this.tokenUri, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": 'application/x-www-form-urlencoded'\n            },\n            body: new URLSearchParams([\n                [\"client_id\", this.clientId],\n                [\"grant_type\", \"refresh_token\"],\n                [\"refresh_token\", this.token.refresh_token]\n            ])\n        });\n        if (!response.ok) {\n            throw new Error(\"Error:\" + response.code + \": \" + response.text());\n        }\n        const token = await response.json();\n        this.token = token;\n        this.accessToken = this._parseToken(token.access_token);\n        this.refreshToken = this._parseToken(token.refresh_token);\n        if (this.refreshCallback) {\n            this.refreshCallback(this.token, this.accessToken, this.refreshToken);\n        }\n    }\n    shouldBeRefreshed(gracePeriod) {\n        const now = new Date().getTime();\n        const refreshTokenExpiresAt = this.refreshToken.payload.exp * 1000;\n        const expired = now > refreshTokenExpiresAt;\n        const shouldRefresh = now - gracePeriod > refreshTokenExpiresAt;\n        return !expired && shouldRefresh;\n    }\n    async refreshIf(gracePeriod) {\n        if (!this.shouldBeRefreshed(gracePeriod)) {\n            return;\n        }\n        await this.refresh();\n    }\n    logout() {\n        const url = new URL(this.logoutUri);\n        url.searchParams.set(\"post_logout_redirect_uri\", this.redirectUri);\n        url.searchParams.set(\"id_token_hint\", this.token.id_token);\n        window.location = url;\n    }\n\n    bearerToken() {\n        return `Bearer ${this.token.access_token}`;\n    }\n    \n    interceptor(gracePeriodBefore, gracePeriodAfter){\n        return new AuthorizationCodeFlowInterceptor(this, gracePeriodBefore, gracePeriodAfter);        \n    }\n}\n\nclass AuthorizationCodeFlowInterceptor {\n    constructor(session, gracePeriodBefore, gracePeriodAfter) {\n        this.session = session;\n        this.gracePeriodBefore = gracePeriodBefore || 2000;\n        this.gracePeriodAfter = gracePeriodAfter || 30000;\n    }\n    async before(request) {\n        await this.session.refreshIf(this.gracePeriodBefore);\n        const headers = new Headers(request.options.headers);\n        headers.set(\"Authorization\", this.session.bearerToken());\n        return request;\n    }\n    async after(request, response) {\n        await this.session.refreshIf(this.gracePeriodAfter);\n        return response;\n    }\n}\n\n\nexport {AuthorizationCodeFlow, AuthorizationCodeFlowSession, AuthorizationCodeFlowInterceptor };","\nconst timing = {\n    sleep(ms) {\n        return new Promise(resolve => setTimeout(resolve, ms));\n    },\n    DEBOUNCE_DEFAULT: 0,\n    DEBOUNCE_IMMEDIATE: 1,\n    debounce(timeoutMs, func, options) {\n        let tid = null;\n        let args = [];\n        let previousTimestamp = 0;\n        let opts = options || timing.DEBOUNCE_DEFAULT;\n\n        const later = () => {\n            const elapsed = new Date().getTime() - previousTimestamp;\n            if (timeoutMs > elapsed) {\n                tid = setTimeout(later, timeoutMs - elapsed);\n                return;\n            }\n            tid = null;\n            if (opts !== timing.DEBOUNCE_IMMEDIATE) {\n                func(...args);\n            }\n            // This check is needed because `func` can recursively invoke `debounced`.\n            if (tid === null) {\n                args = [];\n            }\n        };\n\n        return function () {\n            args = arguments;\n            previousTimestamp = new Date().getTime();\n            if (tid === null) {\n                tid = setTimeout(later, timeoutMs);\n                if (opts === timing.DEBOUNCE_IMMEDIATE) {\n                    func(...args);\n                }\n            }\n        };\n    },\n    THROTTLE_DEFAULT: 0,\n    THROTTLE_NO_LEADING: 1,\n    THROTTLE_NO_TRAILING: 2,\n    throttle(timeoutMs, func, options) {\n        let tid = null;\n        let args = [];\n        let previousTimestamp = 0;\n        let opts = options || timing.THROTTLE_DEFAULT;\n\n        const later = () => {\n            previousTimestamp = (opts & timing.THROTTLE_NO_LEADING) ? 0 : new Date().getTime();\n            tid = null;\n            func(...args);\n            if (tid === null) {\n                args = [];\n            }\n        };\n\n        return function () {\n            const now = new Date().getTime();\n            if (!previousTimestamp && (opts & timing.THROTTLE_NO_LEADING)) {\n                previousTimestamp = now;\n            }\n            const remaining = timeoutMs - (now - previousTimestamp);\n            args = arguments;\n            if (remaining <= 0 || remaining > timeoutMs) {\n                if (tid !== null) {\n                    clearTimeout(tid);\n                    tid = null;\n                }\n                previousTimestamp = now;\n                func(...args);\n                if (tid === null) {\n                    args = [];\n                }\n            } else if (tid === null && !(opts & timing.THROTTLE_NO_TRAILING)) {\n                tid = setTimeout(later, remaining);\n            }\n        };\n\n    }\n};\n\n\nexport { timing };","class Wizard {\n    constructor(el) {\n        this.el = el;\n        this.progress = [...el.children].filter(e => e.matches(\"header,ol,ul\"));\n\n        this.progress.forEach(p => {\n            const children = [...p.children];\n            const current = children.filter(e => e.matches(\".active\"))[0];\n            if (current === undefined && children.length > 0) {\n                children[0].classList.add('active');\n            }\n        });\n        if (this.el.querySelector('section.current') === null) {\n            const firstSection = this.el.querySelector('section:first-of-type');\n            if (firstSection !== null) {\n                firstSection.classList.add('current');\n            }\n        }\n    }\n    next() {\n        this.progress.forEach(p => {\n            const children = [...p.children];\n            const current = children.filter(e => e.matches(\".active\"))[0];\n            current?.classList.remove('active');\n            current?.nextElementSibling?.classList.add('active');\n        });\n        const currentSection = this.el.querySelector('section.current');\n        currentSection.classList.remove(\"current\");\n        currentSection.nextElementSibling.classList.add('current');\n\n        this.el.dispatchEvent(new CustomEvent('wizard:activate', {\n            bubbles: true,\n            cancelable: true\n        }));\n\n    }\n    prev() {\n        this.progress.forEach(p => {\n            const children = [...p.children];\n            const current = children.filter(e => e.matches(\".active\"))[0];\n            current?.classList.remove('active');\n            current?.previousElementSibling?.classList.add('active');\n        });\n        const currentSection = this.el.querySelector('section.current');\n        currentSection.classList.remove(\"current\");\n        currentSection.previousElementSibling.classList.add('current');\n        this.el.dispatchEvent(new CustomEvent('wizard:activate', {\n            bubbles: true,\n            cancelable: true\n        }));\n    }\n    moveTo = function (n) {\n        this.progress.forEach(p => {\n            const children = [...p.children];\n            const current = children.filter(e => e.matches(\".active\"))[0];\n            current?.classList.remove('active');\n            p.children[+n]?.classList.add('active');\n        });\n        const currentSection = this.el.querySelector('section.current');\n        currentSection?.classList.remove(\"current\");\n        const nthSection = this.el.querySelector(`section:nth-child(${+n})`);\n        nthSection.classList.add('current');\n        this.el.dispatchEvent(new CustomEvent('wizard:activate', {\n            bubbles: true,\n            cancelable: true\n        }));\n    }\n}\n\n\n\n\nexport { Wizard };\n","class App {\n    constructor() {\n        this.configurers = [];\n        this.initializers = [];\n        this.handlers = [];\n        this.running = false;\n        document.addEventListener(\"DOMContentLoaded\", async () => {\n            await Promise.all(this.configurers);\n            await Promise.all(this.initializers.map(h => Promise.resolve(h())));\n            await Promise.all(this.handlers.map(h => Promise.resolve(h())));\n        });\n    }\n    configure(cb) {\n        this.configurers.push(Promise.resolve(cb()));\n        return this;\n    }\n    initialize(cb) {\n        this.initializers.push(cb);\n        return this;\n    }\n    ready(cb) {\n        this.handlers.push(cb);\n        return this;\n    }\n}\n\nexport { App };\n"],"names":["mutate","mutators","el","raw","key","values","maybeMutator","dataset","getAttribute","value","checked","Bindings","constructor","extractors","ignoredChildrenSelector","valueHoldersSelector","this","setValues","k","hasOwnProperty","Array","from","querySelectorAll","CSS","escape","forEach","getValues","filter","closest","reduce","result","path","keys","split","map","match","current","previous","i","ckey","pkey","Number","isInteger","isArray","length","undefined","providePath","maybeExtractor","extract","Base64","static","arrayBuffer","dialect","d","URL_SAFE","len","byteLength","view","Uint8Array","res","substring","str","nbytes","Math","floor","vi","si","v1","indexOf","charAt","v2","v3","v4","buffer","STANDARD","Hex","hex","Error","lenInBytes","e","offset","octet","parseInt","bytes","upper","b","toString","toUpperCase","o","padStart","join","Form","bindings","globalErrorsEl","fieldContainerSelector","errorClass","hideClass","DEFAULT_FIELD_CONTAINER_SELECTOR","DEFAULT_ERROR_CLASS","DEFAULT_HIDE_CLASS","setErrors","errors","scrollFirstErrorIntoView","context","clearErrors","mapError","type","name","replace","label","classList","add","reason","globalErrors","innerHTML","remove","yOffsets","getBoundingClientRect","y","window","scrollY","firstErrorScrollY","min","Infinity","scroll","scrollX","l","ContextInterceptor","document","querySelector","endsWith","before","request","separator","resource","startsWith","CsrfTokenInterceptor","v","headers","Headers","options","set","RedirectOnUnauthorizedInterceptor","redirectUri","after","response","status","location","href","Failure","text","def","details","JSON","parse","parseProblems","problems","super","stringify","HttpClientBuilder","interceptors","withContext","push","withCsrfToken","withRedirectOnUnauthorized","withInterceptors","build","HttpClient","async","is","concat","fetch","ok","message","fromResponse","uiOptions","ui","buttons","setAttribute","loader","r","json","form","removeAttribute","Storage","prefix","storage","save","setItem","load","got","getItem","removeItem","pop","decoded","access","LocalStorage","localStorage","SessionStorage","sessionStorage","VersionedStorage","dataSupplier","cache","revision","saved","freshData","data","AuthorizationCodeFlow","clientId","realmBaseUrl","authUri","URL","tokenUri","logoutUri","scope","_auth","pkceVerifier","encode","crypto","getRandomValues","pkceChallenge","subtle","digest","TextEncoder","state","PKCE_AND_STATE_KEY","verifier","url","searchParams","code","history","replaceState","stateAndVerifier","method","body","URLSearchParams","token","AuthorizationCodeFlowSession","get","_tokenExchange","rawHeader","rawPayload","signature","header","atob","payload","accessToken","parseToken","access_token","refreshToken","refresh_token","refreshCallback","onRefresh","callback","_parseToken","shouldBeRefreshed","gracePeriod","now","Date","getTime","refreshTokenExpiresAt","exp","refresh","logout","id_token","bearerToken","interceptor","gracePeriodBefore","gracePeriodAfter","AuthorizationCodeFlowInterceptor","session","refreshIf","timing","sleep","ms","Promise","resolve","setTimeout","DEBOUNCE_DEFAULT","DEBOUNCE_IMMEDIATE","debounce","timeoutMs","func","tid","args","previousTimestamp","opts","later","elapsed","arguments","THROTTLE_DEFAULT","THROTTLE_NO_LEADING","THROTTLE_NO_TRAILING","throttle","remaining","clearTimeout","Wizard","progress","children","matches","p","firstSection","next","nextElementSibling","currentSection","dispatchEvent","CustomEvent","bubbles","cancelable","prev","previousElementSibling","moveTo","n","App","configurers","initializers","handlers","running","addEventListener","all","h","configure","cb","initialize","ready"],"mappings":"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"}